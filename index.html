<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LendTrack - –£—á–µ—Ç –ø–µ—Ä–µ–¥–∞—á</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
            padding-bottom: 80px;
            line-height: 1.5;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .tabs {
            display: flex;
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border-radius: 15px;
            padding: 6px;
            margin-bottom: 24px;
            gap: 4px;
        }

        .tab {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .tab.active {
            background: var(--tg-theme-button-color, var(--primary-color));
            color: var(--tg-theme-button-text-color, #ffffff);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--tg-theme-bg-color, #ffffff);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            border: 2px solid var(--tg-theme-secondary-bg-color, #f8f9fa);
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #6c757d);
            font-weight: 500;
        }

        .transfer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--tg-theme-hint-color, #e9ecef);
        }

        .transfer-item:last-child {
            border-bottom: none;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: 600;
            margin-bottom: 6px;
            font-size: 16px;
        }

        .item-meta {
            font-size: 13px;
            color: var(--tg-theme-hint-color, #6c757d);
            line-height: 1.4;
        }

        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }

        .status-pending { 
            background: #fff3cd; 
            color: #856404; 
        }
        .status-confirmed { 
            background: #d1edff; 
            color: #004085; 
        }
        .status-rejected { 
            background: #f8d7da; 
            color: #721c24; 
        }
        .status-returned { 
            background: #d4edda; 
            color: #155724; 
        }

        .btn {
            background: var(--tg-theme-button-color, var(--primary-color));
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 16px 24px;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            margin-top: 8px;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--tg-theme-secondary-bg-color, #6c757d);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--tg-theme-text-color, #000000);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--tg-theme-hint-color, #e9ecef);
            border-radius: 12px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--tg-theme-button-color, var(--primary-color));
        }

        .category-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .category-tag {
            padding: 8px 16px;
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .category-tag.active {
            background: var(--tg-theme-button-color, var(--primary-color));
            color: var(--tg-theme-button-text-color, #ffffff);
            border-color: var(--tg-theme-button-color, var(--primary-color));
        }

        .emoji-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .emoji-option {
            padding: 12px;
            border: 2px solid var(--tg-theme-hint-color, #e9ecef);
            border-radius: 12px;
            background: var(--tg-theme-bg-color, #ffffff);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
        }

        .emoji-option.selected {
            border-color: var(--tg-theme-button-color, var(--primary-color));
            background: var(--tg-theme-button-color, var(--primary-color));
            color: white;
        }

        .floating-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 64px;
            height: 64px;
            background: var(--tg-theme-button-color, var(--primary-color));
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 50%;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-btn:hover {
            transform: scale(1.1);
        }

        .hidden {
            display: none;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--tg-theme-hint-color, #6c757d);
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .action-buttons .btn {
            flex: 1;
            margin-top: 0;
        }

        .user-info {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 12px;
            margin-top: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <h1>üì¶ LendTrack</h1>
            <p>–£—á–µ—Ç –ø–µ—Ä–µ–¥–∞—á –º–µ–∂–¥—É –¥—Ä—É–∑—å—è–º–∏</p>
            <div class="user-info" id="userHeaderInfo">
                –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('dashboard')">üìä</div>
            <div class="tab" onclick="switchTab('transfers')">üîÑ</div>
            <div class="tab" onclick="switchTab('contacts')">üë•</div>
            <div class="tab" onclick="switchTab('categories')">üè∑Ô∏è</div>
        </div>

        <!-- –î–∞—à–±–æ—Ä–¥ -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="activeTransfers">0</div>
                    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã–µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pendingTransfers">0</div>
                    <div class="stat-label">–û–∂–∏–¥–∞—é—Ç</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalTransfers">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="trustScore">100%</div>
                    <div class="stat-label">–†–µ–π—Ç–∏–Ω–≥</div>
                </div>
            </div>

            <div class="card">
                <h3>üìà –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h3>
                <div id="recentTransfers">
                    <div class="empty-state">
                        <div class="icon">üìã</div>
                        <p>–ü–æ–∫–∞ –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>‚è∞ –°–∫–æ—Ä–æ –≤–µ—Ä–Ω—É—Ç—å</h3>
                <div id="dueSoonTransfers">
                    <div class="empty-state">
                        <div class="icon">‚è≥</div>
                        <p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –≤–æ–∑–≤—Ä–∞—Ç–æ–≤</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–¥–∞—á -->
        <div id="transfers" class="tab-content">
            <div class="card">
                <h3>üîÑ –í—Å–µ –ø–µ—Ä–µ–¥–∞—á–∏</h3>
                <div id="transfersList">
                    <div class="empty-state">
                        <div class="icon">üì¶</div>
                        <p>–ü–æ–∫–∞ –Ω–µ—Ç –ø–µ—Ä–µ–¥–∞—á</p>
                        <button class="btn" onclick="showCreateTransferForm()">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
        <div id="contacts" class="tab-content">
            <div class="card">
                <h3>üë• –ú–æ–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                <div id="contactsList">
                    <div class="empty-state">
                        <div class="icon">üë§</div>
                        <p>–ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
        <div id="categories" class="tab-content">
            <div class="card">
                <h3>üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</h3>
                <div class="category-tags" id="categoriesList">
                    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
                <button class="btn" onclick="showCategoryForm()">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥–∞—á–∏ -->
        <div id="createTransferForm" class="tab-content hidden">
            <div class="card">
                <h3>üì§ –ù–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞</h3>
                
                <div class="form-group">
                    <label>–ß—Ç–æ –ø–µ—Ä–µ–¥–∞–µ—Ç–µ? üì¶</label>
                    <input type="text" id="itemName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –®—É—Ä—É–ø–æ–≤–µ—Ä—Ç, –ö–Ω–∏–≥–∞, –ò–≥—Ä–∞" required>
                </div>

                <div class="form-group">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è üè∑Ô∏è</label>
                    <select id="itemCategory" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>–ö–æ–º—É –ø–µ—Ä–µ–¥–∞–µ—Ç–µ? üë§</label>
                    <input type="text" id="contactName" placeholder="–ò–º—è –¥—Ä—É–≥–∞" required>
                    <input type="tel" id="contactPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="margin-top: 12px;">
                </div>

                <div class="form-group">
                    <label>–°—Ä–æ–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞ üìÖ</label>
                    <input type="date" id="dueDate" required>
                </div>

                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ üìù</label>
                    <textarea id="itemDescription" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–µ–¥–º–µ—Ç–µ..."></textarea>
                </div>

                <div class="action-buttons">
                    <button class="btn" onclick="createTransfer()">‚úÖ –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–¥–∞—á—É</button>
                    <button class="btn btn-secondary" onclick="switchTab('transfers')">‚ùå –û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
        <div id="createCategoryForm" class="tab-content hidden">
            <div class="card">
                <h3>üè∑Ô∏è –ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</h3>
                
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                    <input type="text" id="categoryName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞, –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã" required>
                </div>

                <div class="form-group">
                    <label>–ò–∫–æ–Ω–∫–∞</label>
                    <div class="emoji-picker" id="emojiPicker">
                        <!-- Emoji options will be added by JavaScript -->
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn" onclick="createCategory()">‚úÖ –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                    <button class="btn btn-secondary" onclick="switchTab('categories')">‚ùå –û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <button class="floating-btn" onclick="showCreateTransferForm()">+</button>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        
        // –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let transfers = [];
        let categories = [];
        let contacts = [];
        let selectedEmoji = 'üì¶';
        let currentUser = null;

        // Emoji options –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        const emojiOptions = ['üì¶', 'üõ†Ô∏è', 'üì±', 'üìö', '‚öΩ', 'üè†', 'üëï', 'üéÆ', 'üé®', 'üîß', 'üíé', 'üåø', 'üì∑', 'üéß', 'üíª', '‚åö'];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            tg.expand();
            tg.ready();
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            currentUser = tg.initDataUnsafe.user;
            updateUserInfo();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            loadSampleData();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º emoji picker
            initEmojiPicker();
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            renderAll();
            
            console.log('LendTrack –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—É—â–µ–Ω!', currentUser);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('userHeaderInfo').innerHTML = `
                    üë§ <strong>${currentUser.first_name}</strong>
                    ${currentUser.username ? `@${currentUser.username}` : ''}
                `;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function loadSampleData() {
            // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
            categories = [
                { id: 1, name: '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã', emoji: 'üõ†Ô∏è', color: '#FF6B35' },
                { id: 2, name: '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞', emoji: 'üì±', color: '#4ECDC4' },
                { id: 3, name: '–ö–Ω–∏–≥–∏', emoji: 'üìö', color: '#45B7D1' },
                { id: 4, name: '–°–ø–æ—Ä—Ç', emoji: '‚öΩ', color: '#96CEB4' },
                { id: 5, name: '–î—Ä—É–≥–æ–µ', emoji: 'üì¶', color: '#778899' }
            ];

            // –ü–µ—Ä–µ–¥–∞—á–∏
            transfers = [
                {
                    id: 1,
                    item: '–®—É—Ä—É–ø–æ–≤–µ—Ä—Ç –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–Ω—ã–π',
                    category: '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã',
                    contact: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤',
                    phone: '+79991112233',
                    date: '2024-01-15',
                    dueDate: '2024-01-25',
                    status: 'confirmed',
                    description: '–°–∏–Ω–∏–π, –∫–æ–º–ø–ª–µ–∫—Ç –±–∏—Ç –≤ –∫–æ–º–ø–ª–µ–∫—Ç–µ'
                },
                {
                    id: 2,
                    item: '–ö–Ω–∏–≥–∞ "JavaScript –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤"',
                    category: '–ö–Ω–∏–≥–∏',
                    contact: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞',
                    phone: '+79994445566',
                    date: '2024-01-18',
                    dueDate: '2024-02-01',
                    status: 'pending',
                    description: '–¢–æ–º 2, –≤ –æ—Ç–ª–∏—á–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏'
                },
                {
                    id: 3,
                    item: '–ù–∞—É—à–Ω–∏–∫–∏ –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ',
                    category: '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞',
                    contact: '–ê–ª–µ–∫—Å–µ–π –ö–æ–∑–ª–æ–≤',
                    phone: '+79997778899',
                    date: '2024-01-20',
                    dueDate: '2024-01-30',
                    status: 'returned',
                    description: 'Sony WH-1000XM4, —á–µ—Ä–Ω—ã–µ'
                }
            ];

            // –ö–æ–Ω—Ç–∞–∫—Ç—ã
            contacts = [
                { name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', phone: '+79991112233', trust: 95 },
                { name: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', phone: '+79994445566', trust: 88 },
                { name: '–ê–ª–µ–∫—Å–µ–π –ö–æ–∑–ª–æ–≤', phone: '+79997778899', trust: 92 }
            ];
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è emoji picker
        function initEmojiPicker() {
            const container = document.getElementById('emojiPicker');
            container.innerHTML = '';
            
            emojiOptions.forEach(emoji => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = `emoji-option ${emoji === selectedEmoji ? 'selected' : ''}`;
                button.textContent = emoji;
                button.onclick = () => selectEmoji(emoji);
                container.appendChild(button);
            });
        }

        // –í—ã–±–æ—Ä emoji
        function selectEmoji(emoji) {
            selectedEmoji = emoji;
            document.querySelectorAll('#emojiPicker .emoji-option').forEach(option => {
                option.classList.toggle('selected', option.textContent === emoji);
            });
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName).classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–±—ã
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É —Ç–∞–±–∞
            const tabButtons = document.querySelectorAll('.tab');
            const tabIndex = Array.from(tabButtons).findIndex(button => 
                button.getAttribute('onclick').includes(tabName)
            );
            
            if (tabIndex !== -1) {
                tabButtons[tabIndex].classList.add('active');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥–∞—á–∏
        function showCreateTransferForm() {
            switchTab('createTransferForm');
            renderCategoryOptions();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—É - —Å–µ–≥–æ–¥–Ω—è
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dueDate').min = today;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            document.getElementById('dueDate').value = nextWeek.toISOString().split('T')[0];
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function showCategoryForm() {
            switchTab('createCategoryForm');
            document.getElementById('categoryName').value = '';
            selectedEmoji = 'üì¶';
            initEmojiPicker();
        }

        // –†–µ–Ω–¥–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
        function renderCategoryOptions() {
            const select = document.getElementById('itemCategory');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = `${category.emoji} ${category.name}`;
                select.appendChild(option);
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function createCategory() {
            const name = document.getElementById('categoryName').value.trim();
            
            if (!name) {
                showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º
            if (categories.some(cat => cat.name.toLowerCase() === name.toLowerCase())) {
                showNotification('–û—à–∏–±–∫–∞', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                return;
            }

            const newCategory = {
                id: Date.now(),
                name: name,
                emoji: selectedEmoji,
                color: getRandomColor()
            };

            categories.push(newCategory);
            
            showNotification('–£—Å–ø–µ—Ö', `–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${name}" —Å–æ–∑–¥–∞–Ω–∞`);
            renderCategories();
            switchTab('categories');
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏
        function createTransfer() {
            const itemName = document.getElementById('itemName').value.trim();
            const categoryId = document.getElementById('itemCategory').value;
            const contactName = document.getElementById('contactName').value.trim();
            const contactPhone = document.getElementById('contactPhone').value.trim();
            const dueDate = document.getElementById('dueDate').value;
            const description = document.getElementById('itemDescription').value.trim();

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!itemName || !categoryId || !contactName || !dueDate) {
                showNotification('–û—à–∏–±–∫–∞', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }

            const category = categories.find(cat => cat.id == categoryId);
            if (!category) {
                showNotification('–û—à–∏–±–∫–∞', '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é');
                return;
            }

            const newTransfer = {
                id: Date.now(),
                item: itemName,
                category: category.name,
                categoryEmoji: category.emoji,
                contact: contactName,
                phone: contactPhone,
                date: new Date().toISOString().split('T')[0],
                dueDate: dueDate,
                status: 'pending',
                description: description
            };

            transfers.unshift(newTransfer);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–∞–∫—Ç –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
            if (!contacts.some(contact => contact.name === contactName)) {
                contacts.push({
                    name: contactName,
                    phone: contactPhone,
                    trust: 100
                });
            }
            
            showNotification('–£—Å–ø–µ—Ö', `–ü–µ—Ä–µ–¥–∞—á–∞ "${itemName}" —Å–æ–∑–¥–∞–Ω–∞`);
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            tg.showAlert(`üì® –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${contactName}`);

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            renderAll();
            switchTab('transfers');
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('createTransferForm').querySelectorAll('input, textarea, select').forEach(field => {
                if (field.id !== 'dueDate') {
                    field.value = '';
                }
            });
        }

        // –†–µ–Ω–¥–µ—Ä –≤—Å–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function renderAll() {
            renderDashboard();
            renderTransfers();
            renderCategories();
            renderContacts();
        }

        // –†–µ–Ω–¥–µ—Ä –¥–∞—à–±–æ—Ä–¥–∞
        function renderDashboard() {
            const active = transfers.filter(t => t.status === 'confirmed').length;
            const pending = transfers.filter(t => t.status === 'pending').length;
            const total = transfers.length;
            const trustScore = calculateTrustScore();
            
            document.getElementById('activeTransfers').textContent = active;
            document.getElementById('pendingTransfers').textContent = pending;
            document.getElementById('totalTransfers').textContent = total;
            document.getElementById('trustScore').textContent = `${trustScore}%`;
            
            renderRecentTransfers();
            renderDueSoonTransfers();
        }

        // –†–µ–Ω–¥–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–µ—Ä–µ–¥–∞—á
        function renderRecentTransfers() {
            const container = document.getElementById('recentTransfers');
            const recentTransfers = transfers.slice(0, 5);
            
            if (recentTransfers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üìã</div>
                        <p>–ü–æ–∫–∞ –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recentTransfers.map(transfer => `
                <div class="transfer-item">
                    <div class="item-info">
                        <div class="item-name">${transfer.categoryEmoji || 'üì¶'} ${transfer.item}</div>
                        <div class="item-meta">
                            üë§ ${transfer.contact}<br>
                            üìÖ –î–æ: ${formatDate(transfer.dueDate)}
                        </div>
                    </div>
                    <div class="status status-${transfer.status}">
                        ${getStatusText(transfer.status)}
                    </div>
                </div>
            `).join('');
        }

        // –†–µ–Ω–¥–µ—Ä —Å–∫–æ—Ä–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        function renderDueSoonTransfers() {
            const container = document.getElementById('dueSoonTransfers');
            const today = new Date();
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            const dueSoon = transfers.filter(transfer => {
                const dueDate = new Date(transfer.dueDate);
                return dueDate <= nextWeek && dueDate >= today && transfer.status !== 'returned';
            });
            
            if (dueSoon.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">‚è≥</div>
                        <p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –≤–æ–∑–≤—Ä–∞—Ç–æ–≤</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = dueSoon.map(transfer => `
                <div class="transfer-item">
                    <div class="item-info">
                        <div class="item-name">${transfer.categoryEmoji || 'üì¶'} ${transfer.item}</div>
                        <div class="item-meta">
                            üë§ ${transfer.contact}<br>
                            ‚è∞ ${getDaysUntilDue(transfer.dueDate)}
                        </div>
                    </div>
                    <div class="status status-${transfer.status}">
                        ${getStatusText(transfer.status)}
                    </div>
                </div>
            `).join('');
        }

        // –†–µ–Ω–¥–µ—Ä –ø–µ—Ä–µ–¥–∞—á
        function renderTransfers() {
            const container = document.getElementById('transfersList');
            
            if (transfers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üì¶</div>
                        <p>–ü–æ–∫–∞ –Ω–µ—Ç –ø–µ—Ä–µ–¥–∞—á</p>
                        <button class="btn" onclick="showCreateTransferForm()">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É</button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = transfers.map(transfer => `
                <div class="transfer-item">
                    <div class="item-info">
                        <div class="item-name">${transfer.categoryEmoji || 'üì¶'} ${transfer.item}</div>
                        <div class="item-meta">
                            üë§ ${transfer.contact}<br>
                            üìÖ ${formatDate(transfer.date)} ‚Üí ${formatDate(transfer.dueDate)}
                            ${transfer.description ? `<br>üìù ${transfer.description}` : ''}
                        </div>
                    </div>
                    <div class="status status-${transfer.status}">
                        ${getStatusText(transfer.status)}
                    </div>
                </div>
            `).join('');
        }

        // –†–µ–Ω–¥–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function renderCategories() {
            const container = document.getElementById('categoriesList');
            
            if (categories.length === 0) {
                container.innerHTML = '<div class="empty-state">–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π</div>';
                return;
            }
            
            container.innerHTML = categories.map(category => `
                <div class="category-tag">
                    ${category.emoji} ${category.name}
                </div>
            `).join('');
        }

        // –†–µ–Ω–¥–µ—Ä –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
        function renderContacts() {
            const container = document.getElementById('contactsList');
            
            if (contacts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üë§</div>
                        <p>–ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = contacts.map(contact => `
                <div class="transfer-item">
                    <div class="item-info">
                        <div class="item-name">üë§ ${contact.name}</div>
                        <div class="item-meta">
                            üìû ${contact.phone || '–ù–µ —É–∫–∞–∑–∞–Ω'}<br>
                            ‚≠ê –†–µ–π—Ç–∏–Ω–≥: ${contact.trust}%
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getStatusText(status) {
            const statusMap = {
                'pending': '–û–∂–∏–¥–∞–µ—Ç',
                'confirmed': '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ',
                'rejected': '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ',
                'returned': '–í–æ–∑–≤—Ä–∞—â–µ–Ω–æ'
            };
            return statusMap[status] || status;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }

        function getDaysUntilDue(dueDateString) {
            const dueDate = new Date(dueDateString);
            const today = new Date();
            const diffTime = dueDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return '–°–µ–≥–æ–¥–Ω—è';
            if (diffDays === 1) return '–ó–∞–≤—Ç—Ä–∞';
            if (diffDays > 1) return `–ß–µ—Ä–µ–∑ ${diffDays} –¥–Ω–µ–π`;
            return '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ';
        }

        function calculateTrustScore() {
            if (transfers.length === 0) return 100;
            const returnedOnTime = transfers.filter(t => t.status === 'returned').length;
            return Math.round((returnedOnTime / transfers.length) * 100);
        }

        function getRandomColor() {
            const colors = ['#FF6B35', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#778899'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        function showNotification(title, message) {
            tg.showPopup({
                title: title,
                message: message,
                buttons: [{ type: 'ok' }]
            });
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
